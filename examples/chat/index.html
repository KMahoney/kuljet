<!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/default.css"><title>Kuljet: A Simple Chat Server</title></head><body><div id="navBar" onclick="var navStyle = document.querySelector(&#39;nav&#39;).style; navStyle.display = navStyle.display === &#39;block&#39; ? &#39;none&#39; : &#39;block&#39;"><img src="/bars.svg" style="height: 1.2rem; pointer-events: none;"></div><nav><ul><li>Kuljet</li><ul><li class><a href="/">Introduction</a></li><li class><a href="/install/">Install</a></li><li><a href="https://github.com/KMahoney/kuljet"><img src="/ext.svg" style="height: 0.8rem; margin-right: 0.1rem;">GitHub</a></li></ul><li>Examples</li><ul><li class="selected"><a href="/examples/chat/">A Simple Chat Server</a></li><li class><a href="/examples/forum/">A Forum</a></li><li class><a href="/examples/simplejson/">A Simple JSON API</a></li></ul><li>Guides</li><ul><li class><a href="/guides/expressions/">Expressions</a></li><li class><a href="/guides/structure/">The Structure of a Kuljet Program</a></li><li class><a href="/guides/writing-html/">Writing HTML</a></li><li class><a href="/guides/database/">Interacting with the Database</a></li></ul><li>Reference</li><ul><li class><a href="/reference/stdlib/">Standard Library</a></li></ul><li>Notes</li><ul><li class><a href="/notes/future/">Future Work</a></li></ul></ul></nav><main><h1>A Simple Chat Server</h1><div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" aria-hidden="true" tabindex="-1"></a><span class="kw">table</span><span class="va"> messages</span> { message : text, timestamp : timestamp }</span>
<span id="2"><a href="#2" aria-hidden="true" tabindex="-1"></a></span>
<span id="3"><a href="#3" aria-hidden="true" tabindex="-1"></a><span class="kw">serve</span> <span class="kw">get</span> / =</span>
<span id="4"><a href="#4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span><span class="va"> template</span> = <span class="kw">fun</span> content -&gt;</span>
<span id="5"><a href="#5" aria-hidden="true" tabindex="-1"></a>    [ docType</span>
<span id="6"><a href="#6" aria-hidden="true" tabindex="-1"></a>    , <span class="bu">&lt;html&gt;</span> [ <span class="bu">&lt;head&gt;</span> [ <span class="bu">&lt;link&gt;</span> { href = <span class="st">&quot;/style.css&quot;</span>, rel = <span class="st">&quot;stylesheet&quot;</span> }</span>
<span id="7"><a href="#7" aria-hidden="true" tabindex="-1"></a>                      , <span class="bu">&lt;meta&gt;</span> { name = <span class="st">&quot;viewport&quot;</span>, content = <span class="st">&quot;width=device-width, intial-scale=1&quot;</span> }</span>
<span id="8"><a href="#8" aria-hidden="true" tabindex="-1"></a>                      ]</span>
<span id="9"><a href="#9" aria-hidden="true" tabindex="-1"></a>             , <span class="bu">&lt;body&gt;</span> content</span>
<span id="10"><a href="#10" aria-hidden="true" tabindex="-1"></a>             ]</span>
<span id="11"><a href="#11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="12"><a href="#12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">in</span></span>
<span id="13"><a href="#13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span><span class="va"> messagesHtml</span> =</span>
<span id="14"><a href="#14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span><span class="va"> query</span> = (messages <span class="kw">order</span> timestamp <span class="kw">desc</span> <span class="kw">limit</span> 100) <span class="kw">order</span> timestamp <span class="kw">asc</span> <span class="kw">in</span></span>
<span id="15"><a href="#15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">&lt;div&gt;</span> { class = <span class="st">&quot;messages&quot;</span> }</span>
<span id="16"><a href="#16" aria-hidden="true" tabindex="-1"></a>      (query <span class="kw">select</span> { message } -&gt; <span class="bu">&lt;div&gt;</span> { class = <span class="st">&quot;message&quot;</span> } message)</span>
<span id="17"><a href="#17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">in</span></span>
<span id="18"><a href="#18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span><span class="va"> formHtml</span> =</span>
<span id="19"><a href="#19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span><span class="va"> formAttrs</span> = { method = <span class="st">&quot;POST&quot;</span>, action = <span class="st">&quot;/msg&quot;</span>, class = <span class="st">&quot;inputForm&quot;</span> } <span class="kw">in</span></span>
<span id="20"><a href="#20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span><span class="va"> nameInput</span> = <span class="bu">&lt;input&gt;</span> { name = <span class="st">&quot;message&quot;</span>, class = <span class="st">&quot;inputMessage&quot;</span>, autofocus = <span class="st">&quot;true&quot;</span> } <span class="kw">in</span></span>
<span id="21"><a href="#21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span><span class="va"> submitInput</span> = <span class="bu">&lt;input&gt;</span> { type = <span class="st">&quot;submit&quot;</span> } <span class="kw">in</span></span>
<span id="22"><a href="#22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">&lt;form&gt;</span> formAttrs [ nameInput, submitInput ]</span>
<span id="23"><a href="#23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">in</span></span>
<span id="24"><a href="#24" aria-hidden="true" tabindex="-1"></a>  template [ messagesHtml, formHtml ]</span>
<span id="25"><a href="#25" aria-hidden="true" tabindex="-1"></a></span>
<span id="26"><a href="#26" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span><span class="va"> insertMessage</span> =</span>
<span id="27"><a href="#27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fun</span> msg -&gt;</span>
<span id="28"><a href="#28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">insert</span><span class="va"> messages</span> { message = msg, timestamp = now }</span>
<span id="29"><a href="#29" aria-hidden="true" tabindex="-1"></a></span>
<span id="30"><a href="#30" aria-hidden="true" tabindex="-1"></a><span class="kw">serve</span> <span class="kw">post</span> /msg =</span>
<span id="31"><a href="#31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fun</span> formVars: { message: text } -&gt;</span>
<span id="32"><a href="#32" aria-hidden="true" tabindex="-1"></a>    insertMessage formVars.message <span class="kw">then</span></span>
<span id="33"><a href="#33" aria-hidden="true" tabindex="-1"></a>    redirect <span class="st">&quot;/&quot;</span></span>
<span id="34"><a href="#34" aria-hidden="true" tabindex="-1"></a></span>
<span id="35"><a href="#35" aria-hidden="true" tabindex="-1"></a><span class="kw">serve</span> <span class="kw">get</span> /style.css =</span>
<span id="36"><a href="#36" aria-hidden="true" tabindex="-1"></a>  file <span class="st">&quot;text/css&quot;</span> <span class="st">&quot;style.css&quot;</span></span></code></pre></div></main></body></html>